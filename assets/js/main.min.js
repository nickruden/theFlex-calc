const optionsData={angarsk:{startPrice:26970,motivator:3500,nolimit:1e3,massage:3500,"20-trainings":5e3,fullday:3500,"15-freezing":990,"30-freezing":1500,"2-mounth":3e3,"summer-events":2e3},kazan:{startPrice:33e3,motivator:3500,nolimit:1e3,massage:3500,"20-trainings":5e3,fullday:3500,"15-freezing":990,"30-freezing":1500,"2-mounth":3e3,"summer-events":2e3},tyumen:{startPrice:29700,motivator:3500,nolimit:1e3,massage:3500,"20-trainings":5e3,fullday:3500,"15-freezing":990,"30-freezing":1500,"2-mounth":3e3,"summer-events":2e3},saratov:{startPrice:26970,motivator:3500,nolimit:1e3,massage:3500,"20-trainings":5e3,fullday:3500,"15-freezing":990,"30-freezing":1500,"2-mounth":3e3,"summer-events":2e3},ekaterinburg:{startPrice:26970,motivator:3500,nolimit:1e3,massage:3500,"20-trainings":5e3,fullday:3500,"15-freezing":990,"30-freezing":1500,"2-mounth":3e3,"summer-events":2e3},ufa:{startPrice:26970,motivator:3500,nolimit:1e3,massage:3500,"20-trainings":5e3,fullday:3500,"15-freezing":990,"30-freezing":1500,"2-mounth":3e3,"summer-events":2e3},chelyabinsk:{startPrice:26970,motivator:3500,nolimit:1e3,massage:3500,"20-trainings":5e3,fullday:3500,"15-freezing":990,"30-freezing":1500,"2-mounth":3e3,"summer-events":2e3},krasnoyarsk:{startPrice:26970,motivator:3500,nolimit:1e3,massage:3500,"20-trainings":5e3,fullday:3500,"15-freezing":990,"30-freezing":1500,"2-mounth":3e3,"summer-events":2e3},novosibirsk:{startPrice:26970,motivator:3500,nolimit:1e3,massage:3500,"20-trainings":5e3,fullday:3500,"15-freezing":990,"30-freezing":1500,"2-mounth":3e3,"summer-events":2e3}},formData={name:"",phone:"",city:"",sendingAgree:!1,selectedOptions:[],totalPrice:0,monthlyPrice:0,plaitePrice:0};let selectedOptions=new Set;const STORAGE_KEY="gymFormState";function saveSessionState(){let e={formData,selectedOptions:Array.from(selectedOptions),currentPage:getCurrentPage()};localStorage.setItem(STORAGE_KEY,JSON.stringify(e))}function loadSessionState(){let e=localStorage.getItem(STORAGE_KEY);if(!e)return null;try{return JSON.parse(e)}catch(t){return null}}function clearSessionState(){localStorage.removeItem(STORAGE_KEY)}function getCurrentPage(){let e=document.querySelector(".options"),t=document.querySelector(".bonuses-page");return e.classList.contains("--final-page")?"final":t.classList.contains("--display-none")?"form":"bonuses"}const updateFormData=()=>{formData.name=document.querySelector("#clientName").value,formData.phone=document.querySelector("#clientPhone").value,formData.city=document.querySelector("#recipientCity").value,formData.sendingAgree=document.querySelector("#sendingAgree").checked,formData.selectedOptions=Array.from(selectedOptions),saveSessionState()};let localTick;function handleTickInit(e){if(localTick=e,!window.timerInitialized&&localStorage.getItem("tickStarted")){let t="tickDeadline",n,i=localStorage.getItem(t);if(i)n=new Date(i);else{let a=new Date;n=new Date(a.getTime()+3e5),localStorage.setItem(t,n.toISOString())}let r=Tick.count.down(n,{format:["m","s"]});r.onupdate=function(t){e&&(e.value=t)},r.onended=function(){localStorage.removeItem("gymFormState")},window.timerInitialized=!0}}document.addEventListener("DOMContentLoaded",()=>{let e=document.querySelector(".wrapper"),t=e.querySelector(".header"),n=e.querySelector(".form-page"),i=e.querySelector(".bonuses-page"),a=e.querySelector(".options"),r=e.querySelector(".form-page .control-buttons .my-button"),o=e.querySelector(".bonuses-page .back-button"),s=e.querySelector(".bonuses-page .next-button"),l=document.querySelector("#clientName"),$=document.querySelector("#clientPhone"),c=document.querySelector("#sendingAgree"),d=document.querySelector("#policyAgree"),u=document.querySelector("#recipientCity"),m=document.querySelectorAll(".options__item"),f=document.querySelector(".your-card__price-number");function p(){let e=document.querySelector('[data-final-btn-id="all-price"] .final-page__option-price-number');e&&(e.textContent=`${formData.totalPrice.toLocaleString()}₽`);let t=document.querySelector('[data-final-btn-id="plade"] .final-page__option-price-number'),n=document.querySelector('[data-final-btn-id="plade"] .plade-end__number');t&&(t.textContent=`${formData.plaitePrice.toLocaleString()}₽`),n&&(n.textContent=`${formData.plaitePrice.toLocaleString()}}₽`);let i=document.querySelector('[data-final-btn-id="in-month"] .final-page__option-price-number');i&&(i.textContent=`${formData.monthlyPrice.toLocaleString()}₽`)}let y=()=>u.value,g=e=>{let t=optionsData[e];t&&(m.forEach(e=>{let n=e.dataset.optId,i=e.querySelector(".options__item-price"),a=t[n];if(i&&void 0!==a){let r=Array.from(i.childNodes).filter(e=>e.nodeType===Node.TEXT_NODE);r.length>0?r[0].textContent=`+${a.toLocaleString()}₽`:i.insertBefore(document.createTextNode(`+${a.toLocaleString()}₽`),i.firstChild)}}),h(),p())},v=(e,t)=>{if(["validPeriod","20-trainings","fullday"].includes(e))return;let n=document.querySelector(`.your-card__option[id="${e}"]`);n&&(n.style.display=t?"inline":"none")},S=()=>{let e=document.querySelector('.your-card__option[id="freezing"]');if(!e)return;let t=selectedOptions.has("15-freezing"),n=selectedOptions.has("30-freezing");if(t||n){e.style.display="inline";let i=n?"30":"15";e.innerHTML=e.innerHTML.replace(/\d+ дней/,`${i} дней`)}else e.style.display="none"},h=()=>{let e=y(),t=optionsData[e];if(!t)return;let n=t.startPrice||0,i=selectedOptions.has("2-mounth")?12:10,a=selectedOptions.has("nolimit"),r=document.querySelector(".your-card__option[id='20-trainings']");r&&(r.style.display=a?"none":"inline"),selectedOptions.forEach(e=>{"nolimit"===e?n+=1e3*i:n+=t[e]||0});let o=document.querySelector(".your-card__option[id='validPeriod']");o.innerHTML=o.innerHTML.replace(/\d+ месяцев/,`${i} месяцев`),S();let s=document.querySelector('.your-card__option[id="20-trainings"]');s&&(s.innerHTML=s.innerHTML.replace(/(60|80) тренировок/,selectedOptions.has("20-trainings")?"80 тренировок":"60 тренировок"));let l=document.querySelector('.your-card__option[id="fullday"]');l&&(l.innerHTML=l.innerHTML.replace(/до\s(16:00|22:00)/,selectedOptions.has("fullday")?"до 22:00":"до 16:00"));let $=Math.round(n/i);f.textContent=`${$.toLocaleString()}₽`;let c=Math.round(.25*n);formData.totalPrice=n,formData.monthlyPrice=$,formData.plaitePrice=c,updateFormData();let d=Array.from(document.querySelectorAll(".your-card__option")).filter(e=>"inline"===getComputedStyle(e).display);d.forEach((e,t)=>{let n=e.querySelector(".gray-text");n?(n.textContent=n.textContent.replace(/[.,]\s*$/,""),n.textContent+=t===d.length-1?".":","):(e.innerHTML=e.innerHTML.replace(/[.,]\s*$/,""),e.innerHTML+=t===d.length-1?".":",")}),saveSessionState()},L=(e,t)=>{let n=document.querySelector(`.options__item[data-opt-id="${e}"] .my-switch-main`);if(n){if(n.checked=t,"15-freezing"===e&&t){selectedOptions.delete("30-freezing");let i=document.querySelector('.options__item[data-opt-id="30-freezing"] .my-switch-main');i&&(i.checked=!1)}if("30-freezing"===e&&t){selectedOptions.delete("15-freezing");let a=document.querySelector('.options__item[data-opt-id="15-freezing"] .my-switch-main');a&&(a.checked=!1)}t?(selectedOptions.add(e),v(e,!0)):(selectedOptions.delete(e),v(e,!1)),h(),p()}};function _(e){return/^[A-Za-zА-Яа-яЁё\s\-]{2,}$/.test(e.trim())}function k(e){let t=e.replace(/\D/g,"");return 11===t.length}function q(){let e=!0;return _(l.value)?l.classList.remove("invalid"):(l.classList.add("invalid"),e=!1),k($.value)?$.classList.remove("invalid"):($.classList.add("invalid"),e=!1),d.checked?d.closest(".my-checkbox-btn").classList.remove("invalid"):(d.closest(".my-checkbox-btn").classList.add("invalid"),e=!1),e}function D(){return i.classList.contains("--display-none")?(e.classList.add("--white-bg"),t.classList.add("--form-page"),!1):(e.classList.remove("--white-bg"),t.classList.remove("--form-page"),!0)}l.addEventListener("input",updateFormData),$.addEventListener("input",updateFormData),c.addEventListener("change",updateFormData),d.addEventListener("change",()=>{d.closest(".my-checkbox-btn").classList.remove("invalid")}),u.addEventListener("change",()=>{g(y()),updateFormData()}),m.forEach(e=>{let t=e.querySelector(".my-switch-main"),n=e.dataset.optId;t.addEventListener("change",()=>{let e=t.checked;"nolimit"===n&&e&&L("20-trainings",!1),"20-trainings"===n&&e&&L("nolimit",!1),L(n,e)})}),[l,$].forEach(e=>{e.addEventListener("focus",()=>{e.classList.remove("invalid")})}),r.addEventListener("click",e=>{e.preventDefault(),q()&&(n.classList.add("--display-none"),i.classList.remove("--display-none"),D(),localStorage.getItem("tickStarted")||localStorage.setItem("tickStarted","true"),handleTickInit(localTick),saveSessionState())}),o.addEventListener("click",()=>{a.classList.contains("--final-page")?(a.classList.remove("--final-page"),D(),saveSessionState()):(n.classList.remove("--display-none"),i.classList.add("--display-none"),D(),l.value=formData.name,$.value=formData.phone,c.checked=formData.sendingAgree,u.value=formData.city,g(y()),updateFormData())}),s&&s.addEventListener("click",()=>{a.classList.add("--final-page"),p(),saveSessionState()}),document.querySelectorAll(".your-card__option").forEach(e=>e.style.display="none"),document.querySelector(".your-card__option[id='validPeriod']").style.display="inline",document.querySelector(".your-card__option[id='20-trainings']").style.display="inline",document.querySelector(".your-card__option[id='fullday']").style.display="inline";let b=loadSessionState();if(b){let{formData:z,selectedOptions:E,currentPage:P}=b;l.value=z.name,$.value=z.phone,u.value=z.city,c.checked=z.sendingAgree,selectedOptions=new Set(E||[]),E.forEach(e=>{L(e,!0)}),"bonuses"===P&&(n.classList.add("--display-none"),i.classList.remove("--display-none"),e.classList.add("--white-bg"),t.classList.add("--form-page")),"final"===P&&(n.classList.add("--display-none"),i.classList.remove("--display-none"),a.classList.add("--final-page"),p(),e.classList.add("--white-bg"),t.classList.add("--form-page")),g(y()),h(),updateFormData(),p()}else g(y()),h(),updateFormData(),p();D(),new SimpleBar(document.querySelector(".options__inner"),{autoHide:!1,forceVisible:!0});let O={irkutsk:"Иркутск",angarsk:"Ангарск",krasnoyarskVesni:"Красноярск. Весны",krasnoyarskUritskogo:"Красноярск. Урицкого",novosibirskZyryanovskaya:"Новосибирск. Зыряновская",novosibirskDusi:"Новосибирск. Дуси",tyumen:"Тюмень",saratov:"Саратов",ekaterinburg:"Екатеринбург",ufa:"Уфа",chelyabinsk:"Челябинск"},T={motivator:"+Мотиватор",nolimit:"+Безлимит",massage:"+Массаж","20-trainings":"+20 тренировок",fullday:"+Полный день","15-freezing":"+15 дней заморозки","30-freezing":"+30 дней заморозки","2-mounth":"+2 месяца","summer-events":"+Летние мероприятия"};function w(){let e=formData.name.trim(),t=formData.phone.trim(),n=formData.totalPrice.toLocaleString(),i=formData.city,a=O[i],r=formData.selectedOptions.map(e=>T[e]).filter(Boolean),o="60 тренировок",s="дневная карта (до 16:00)";r.includes("+Безлимит")&&(o="безлимит"),r.includes("+Полный день")&&(s="дневная карта (до 18:00)");let l=r.length>0?`опции ${r.join(", ")}`:null,$=`Здравствуйте! Это ${e}, телефон ${t}, г. ${a}, я выбрала 10 месяцев, ${o}, ${s}${l?`, ${l}`:""}, сумма получилась ${n}₽`,c=encodeURIComponent($);return`https://wa.me/79245372601?text=${c}&type=phone_number`}let x=document.querySelector(".final-page__button");x&&x.addEventListener("click",function(e){let t=w();x.setAttribute("href",t)})});