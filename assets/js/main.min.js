const optionsData={irkutsk:{startPrice:26970,motivator:3500,nolimit:1e3,massage:3500,"20-trainings":5e3,fullday:3500,"15-freezing":990,"30-freezing":1500,"2-mounth":3e3,"summer-events":2e3},angarsk:{startPrice:26970,motivator:3e3,nolimit:3e3,massage:3e3,"20-trainings":3e3,fullday:3e3,"15-freezing":3e3,"30-freezing":3e3,"2-mounth":3e3,"summer-events":3e3}},formData={name:"",phone:"",city:"",sendingAgree:!1,selectedOptions:[],totalPrice:0,monthlyPrice:0,plaitePrice:0};let selectedOptions=new Set;const STORAGE_KEY="gymFormState";function saveSessionState(){let e={formData,selectedOptions:Array.from(selectedOptions),currentPage:getCurrentPage()};localStorage.setItem(STORAGE_KEY,JSON.stringify(e))}function loadSessionState(){let e=localStorage.getItem(STORAGE_KEY);if(!e)return null;try{return JSON.parse(e)}catch(t){return null}}function clearSessionState(){localStorage.removeItem(STORAGE_KEY)}function getCurrentPage(){let e=document.querySelector(".options"),t=document.querySelector(".bonuses-page");return e.classList.contains("--final-page")?"final":t.classList.contains("--display-none")?"form":"bonuses"}const updateFormData=()=>{formData.name=document.querySelector("#clientName").value,formData.phone=document.querySelector("#clientPhone").value,formData.city=document.querySelector("#recipientCity").value,formData.sendingAgree=document.querySelector("#sendingAgree").checked,formData.selectedOptions=Array.from(selectedOptions),saveSessionState()};let localTick;function handleTickInit(e){if(localTick=e,!window.timerInitialized&&localStorage.getItem("tickStarted")){let t="tickDeadline",n,i=localStorage.getItem(t);if(i)n=new Date(i);else{let a=new Date;n=new Date(a.getTime()+3e5),localStorage.setItem(t,n.toISOString())}let r=Tick.count.down(n,{format:["m","s"]});r.onupdate=function(t){e&&(e.value=t)},r.onended=function(){localStorage.removeItem("gymFormState")},window.timerInitialized=!0}}document.addEventListener("DOMContentLoaded",()=>{let e=document.querySelector(".wrapper"),t=e.querySelector(".header"),n=e.querySelector(".form-page"),i=e.querySelector(".bonuses-page"),a=e.querySelector(".options"),r=e.querySelector(".form-page .control-buttons .my-button"),o=e.querySelector(".bonuses-page .back-button"),l=e.querySelector(".bonuses-page .next-button"),s=document.querySelector("#clientName"),c=document.querySelector("#clientPhone"),d=document.querySelector("#sendingAgree"),u=document.querySelector("#policyAgree"),m=document.querySelector("#recipientCity"),p=document.querySelectorAll(".options__item"),y=document.querySelector(".your-card__price-number");function f(){let e=document.querySelector('[data-final-btn-id="all-price"] .final-page__option-price-number');e&&(e.textContent=`${formData.totalPrice.toLocaleString()}₽`);let t=document.querySelector('[data-final-btn-id="plade"] .final-page__option-price-number'),n=document.querySelector('[data-final-btn-id="plade"] .plade-end__number');t&&(t.textContent=`${formData.plaitePrice.toLocaleString()}₽`),n&&(n.textContent=`${formData.plaitePrice.toLocaleString()}}₽`);let i=document.querySelector('[data-final-btn-id="in-month"] .final-page__option-price-number');i&&(i.textContent=`${formData.monthlyPrice.toLocaleString()}₽`)}let $=()=>m.value,g=e=>{let t=optionsData[e];t&&(p.forEach(e=>{let n=e.dataset.optId,i=e.querySelector(".options__item-price"),a=t[n];if(i&&void 0!==a){let r=Array.from(i.childNodes).filter(e=>e.nodeType===Node.TEXT_NODE);r.length>0?r[0].textContent=`+${a.toLocaleString()}₽`:i.insertBefore(document.createTextNode(`+${a.toLocaleString()}₽`),i.firstChild)}}),h(),f())},S=(e,t)=>{if(["validPeriod","20-trainings","fullday"].includes(e))return;let n=document.querySelector(`.your-card__option[id="${e}"]`);n&&(n.style.display=t?"inline":"none")},v=()=>{let e=document.querySelector('.your-card__option[id="freezing"]');if(!e)return;let t=selectedOptions.has("15-freezing"),n=selectedOptions.has("30-freezing");if(t||n){e.style.display="inline";let i=n?"30":"15";e.innerHTML=e.innerHTML.replace(/\d+ дней/,`${i} дней`)}else e.style.display="none"},h=()=>{let e=$(),t=optionsData[e];if(!t)return;let n=t.startPrice||0,i=selectedOptions.has("2-mounth")?12:10,a=selectedOptions.has("nolimit"),r=document.querySelector(".your-card__option[id='20-trainings']");r&&(r.style.display=a?"none":"inline"),selectedOptions.forEach(e=>{"nolimit"===e?n+=1e3*i:n+=t[e]||0});let o=document.querySelector(".your-card__option[id='validPeriod']");o.innerHTML=o.innerHTML.replace(/\d+ месяцев/,`${i} месяцев`),v();let l=document.querySelector('.your-card__option[id="20-trainings"]');l&&(l.innerHTML=l.innerHTML.replace(/(60|80) тренировок/,selectedOptions.has("20-trainings")?"80 тренировок":"60 тренировок"));let s=document.querySelector('.your-card__option[id="fullday"]');s&&(s.innerHTML=s.innerHTML.replace(/до\s(16:00|22:00)/,selectedOptions.has("fullday")?"до 22:00":"до 16:00"));let c=Math.round(n/i);y.textContent=`${c.toLocaleString()}₽`;let d=Math.round(.25*n);formData.totalPrice=n,formData.monthlyPrice=c,formData.plaitePrice=d,updateFormData();let u=Array.from(document.querySelectorAll(".your-card__option")).filter(e=>"inline"===getComputedStyle(e).display);u.forEach((e,t)=>{let n=e.querySelector(".gray-text");n?(n.textContent=n.textContent.replace(/[.,]\s*$/,""),n.textContent+=t===u.length-1?".":","):(e.innerHTML=e.innerHTML.replace(/[.,]\s*$/,""),e.innerHTML+=t===u.length-1?".":",")}),saveSessionState()},L=(e,t)=>{let n=document.querySelector(`.options__item[data-opt-id="${e}"] .my-switch-main`);if(n){if(n.checked=t,"15-freezing"===e&&t){selectedOptions.delete("30-freezing");let i=document.querySelector('.options__item[data-opt-id="30-freezing"] .my-switch-main');i&&(i.checked=!1)}if("30-freezing"===e&&t){selectedOptions.delete("15-freezing");let a=document.querySelector('.options__item[data-opt-id="15-freezing"] .my-switch-main');a&&(a.checked=!1)}t?(selectedOptions.add(e),S(e,!0)):(selectedOptions.delete(e),S(e,!1)),h(),f()}};function q(e){return/^[A-Za-zА-Яа-яЁё\s\-]{2,}$/.test(e.trim())}function D(e){let t=e.replace(/\D/g,"");return 11===t.length}function k(){let e=!0;return q(s.value)?s.classList.remove("invalid"):(s.classList.add("invalid"),e=!1),D(c.value)?c.classList.remove("invalid"):(c.classList.add("invalid"),e=!1),u.checked?u.closest(".my-checkbox-btn").classList.remove("invalid"):(u.closest(".my-checkbox-btn").classList.add("invalid"),e=!1),e}function b(){return i.classList.contains("--display-none")?(e.classList.add("--white-bg"),t.classList.add("--form-page"),!1):(e.classList.remove("--white-bg"),t.classList.remove("--form-page"),!0)}s.addEventListener("input",updateFormData),c.addEventListener("input",updateFormData),d.addEventListener("change",updateFormData),u.addEventListener("change",()=>{u.closest(".my-checkbox-btn").classList.remove("invalid")}),m.addEventListener("change",()=>{g($()),updateFormData()}),p.forEach(e=>{let t=e.querySelector(".my-switch-main"),n=e.dataset.optId;t.addEventListener("change",()=>{let e=t.checked;"nolimit"===n&&e&&L("20-trainings",!1),"20-trainings"===n&&e&&L("nolimit",!1),L(n,e)})}),[s,c].forEach(e=>{e.addEventListener("focus",()=>{e.classList.remove("invalid")})}),r.addEventListener("click",e=>{e.preventDefault(),k()&&(n.classList.add("--display-none"),i.classList.remove("--display-none"),b(),localStorage.getItem("tickStarted")||localStorage.setItem("tickStarted","true"),handleTickInit(localTick),saveSessionState())}),o.addEventListener("click",()=>{a.classList.contains("--final-page")?(a.classList.remove("--final-page"),b(),saveSessionState()):(n.classList.remove("--display-none"),i.classList.add("--display-none"),b(),s.value=formData.name,c.value=formData.phone,d.checked=formData.sendingAgree,m.value=formData.city,g($()),updateFormData())}),l&&l.addEventListener("click",()=>{a.classList.add("--final-page"),f(),saveSessionState()}),document.querySelectorAll(".your-card__option").forEach(e=>e.style.display="none"),document.querySelector(".your-card__option[id='validPeriod']").style.display="inline",document.querySelector(".your-card__option[id='20-trainings']").style.display="inline",document.querySelector(".your-card__option[id='fullday']").style.display="inline";let _=loadSessionState();if(_){let{formData:E,selectedOptions:O,currentPage:T}=_;s.value=E.name,c.value=E.phone,m.value=E.city,d.checked=E.sendingAgree,selectedOptions=new Set(O||[]),O.forEach(e=>{L(e,!0)}),"bonuses"===T&&(n.classList.add("--display-none"),i.classList.remove("--display-none"),e.classList.add("--white-bg"),t.classList.add("--form-page")),"final"===T&&(n.classList.add("--display-none"),i.classList.remove("--display-none"),a.classList.add("--final-page"),f(),e.classList.add("--white-bg"),t.classList.add("--form-page")),g($()),h(),updateFormData(),f()}else g($()),h(),updateFormData(),f();b(),new SimpleBar(document.querySelector(".options__inner"),{autoHide:!1,forceVisible:!0});let P={irkutsk:"Иркутск",angarsk:"Ангарск",krasnoyarskVesni:"Красноярск. Весны",krasnoyarskUritskogo:"Красноярск. Урицкого",novosibirskZyryanovskaya:"Новосибирск. Зыряновская",novosibirskDusi:"Новосибирск. Дуси",tyumen:"Тюмень",saratov:"Саратов",ekaterinburg:"Екатеринбург",ufa:"Уфа",chelyabinsk:"Челябинск"},z={motivator:"+Мотиватор",nolimit:"+Безлимит",massage:"+Массаж","20-trainings":"+20 тренировок",fullday:"+Полный день","15-freezing":"+15 дней заморозки","30-freezing":"+30 дней заморозки","2-mounth":"+2 месяца","summer-events":"+Летние мероприятия"};function w(){let e=formData.name.trim(),t=formData.phone.trim(),n=formData.totalPrice.toLocaleString(),i=formData.city,a=P[i],r=formData.selectedOptions.map(e=>z[e]).filter(Boolean),o="60 тренировок",l="дневная карта (до 16:00)";r.includes("+Безлимит")&&(o="безлимит"),r.includes("+Полный день")&&(l="дневная карта (до 18:00)");let s=r.length>0?`опции ${r.join(", ")}`:null,c=`Здравствуйте! Это ${e}, телефон ${t}, г. ${a}, я выбрала 10 месяцев, ${o}, ${l}${s?`, ${s}`:""}, сумма получилась ${n}₽`,d=encodeURIComponent(c);return`https://wa.me/79245372601?text=${d}&type=phone_number`}let x=document.querySelector(".final-page__button");x&&x.addEventListener("click",function(e){let t=w();x.setAttribute("href",t)})});