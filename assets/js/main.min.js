const optionsData={angarsk:{startPrice:26970,motivator:3500,nolimit:1e3,massage:3500,"20-trainings":5e3,fullday:3500,"15-freezing":990,"30-freezing":1500,"2-mounth":3e3,"summer-events":2e3},kazan:{startPrice:33e3,motivator:3500,nolimit:1e3,massage:3500,"20-trainings":5e3,fullday:3500,"15-freezing":990,"30-freezing":1500,"2-mounth":3e3,"summer-events":2e3},tyumen:{startPrice:29700,motivator:3500,nolimit:1e3,massage:3500,"20-trainings":5e3,fullday:3500,"15-freezing":990,"30-freezing":1500,"2-mounth":3e3,"summer-events":2e3},saratov:{startPrice:26970,motivator:3500,nolimit:1e3,massage:3500,"20-trainings":5e3,fullday:3500,"15-freezing":990,"30-freezing":1500,"2-mounth":3e3,"summer-events":2e3},ekaterinburg:{startPrice:26970,motivator:3500,nolimit:1e3,massage:3500,"20-trainings":5e3,fullday:3500,"15-freezing":990,"30-freezing":1500,"2-mounth":3e3,"summer-events":2e3},ufa:{startPrice:26970,motivator:3500,nolimit:1e3,massage:3500,"20-trainings":5e3,fullday:3500,"15-freezing":990,"30-freezing":1500,"2-mounth":3e3,"summer-events":2e3},chelyabinsk:{startPrice:26970,motivator:3500,nolimit:1e3,massage:3500,"20-trainings":5e3,fullday:3500,"15-freezing":990,"30-freezing":1500,"2-mounth":3e3,"summer-events":2e3},krasnoyarsk:{startPrice:26970,motivator:3500,nolimit:1e3,massage:3500,"20-trainings":5e3,fullday:3500,"15-freezing":990,"30-freezing":1500,"2-mounth":3e3,"summer-events":2e3},novosibirsk:{startPrice:26970,motivator:3500,nolimit:1e3,massage:3500,"20-trainings":5e3,fullday:3500,"15-freezing":990,"30-freezing":1500,"2-mounth":3e3,"summer-events":2e3}},formData={name:"",phone:"",city:"",sendingAgree:!1,selectedOptions:[],totalPrice:0,monthlyPrice:0,plaitePrice:0};let selectedOptions=new Set;const STORAGE_KEY="gymFormState";function saveSessionState(){let e={formData,selectedOptions:Array.from(selectedOptions),currentPage:getCurrentPage()};localStorage.setItem(STORAGE_KEY,JSON.stringify(e))}function loadSessionState(){let e=localStorage.getItem(STORAGE_KEY);if(!e)return null;try{return JSON.parse(e)}catch(t){return null}}function clearSessionState(){localStorage.removeItem(STORAGE_KEY)}function getCurrentPage(){let e=document.querySelector(".options"),t=document.querySelector(".bonuses-page");return e.classList.contains("--final-page")?"final":t.classList.contains("--display-none")?"form":"bonuses"}const updateFormData=()=>{formData.name=document.querySelector("#clientName").value,formData.phone=document.querySelector("#clientPhone").value,formData.city=document.querySelector("#recipientCity").value,formData.sendingAgree=document.querySelector("#sendingAgree").checked,formData.selectedOptions=Array.from(selectedOptions),saveSessionState()};let localTick;function handleTickInit(e){if(localTick=e,!window.timerInitialized&&localStorage.getItem("tickStarted")){let t="tickDeadline",n,a=localStorage.getItem(t);if(a)n=new Date(a);else{let i=new Date;n=new Date(i.getTime()+24e5),localStorage.setItem(t,n.toISOString())}let r=Tick.count.down(n,{format:["m","s"]});r.onupdate=function(t){e&&(e.value=t)},r.onended=function(){localStorage.removeItem("gymFormState")},window.timerInitialized=!0}}document.addEventListener("DOMContentLoaded",()=>{let e=document.querySelector(".wrapper"),t=e.querySelector(".header"),n=e.querySelector(".form-page"),a=e.querySelector(".bonuses-page"),i=e.querySelector(".options"),r=e.querySelector(".form-page .control-buttons .my-button"),o=e.querySelector(".bonuses-page .back-button"),s=e.querySelector(".bonuses-page .next-button"),l=document.querySelector("#clientName"),$=document.querySelector("#clientPhone"),c=document.querySelector("#sendingAgree"),d=document.querySelector("#policyAgree"),m=document.querySelector("#recipientCity"),u=document.querySelectorAll(".options__item"),p=document.querySelector(".your-card__price-number");function f(){let e=document.querySelector('[data-final-btn-id="all-price"] .final-page__option-price-number');e&&(e.textContent=`${formData.totalPrice.toLocaleString()}₽`);let t=document.querySelector('[data-final-btn-id="plade"] .final-page__option-price-number'),n=document.querySelector('[data-final-btn-id="plade"] .plade-end__number');t&&(t.textContent=`${formData.plaitePrice.toLocaleString()}₽`),n&&(n.textContent=`${formData.plaitePrice.toLocaleString()}}₽`);let a=document.querySelector('[data-final-btn-id="in-month"] .final-page__option-price-number');a&&(a.textContent=`${formData.monthlyPrice.toLocaleString()}₽`)}let y=()=>m.value,g=e=>{let t=optionsData[e];t&&(u.forEach(e=>{let n=e.dataset.optId,a=e.querySelector(".options__item-price"),i=t[n];if(a&&void 0!==i){let r=Array.from(a.childNodes).filter(e=>e.nodeType===Node.TEXT_NODE);r.length>0?r[0].textContent=`+${i.toLocaleString()}₽`:a.insertBefore(document.createTextNode(`+${i.toLocaleString()}₽`),a.firstChild)}}),v(),f())},S=(e,t)=>{if(["validPeriod","20-trainings","fullday"].includes(e))return;let n=document.querySelector(`.your-card__option[id="${e}"]`);n&&(n.style.display=t?"inline":"none")},h=()=>{let e=document.querySelector('.your-card__option[id="freezing"]');if(!e)return;let t=selectedOptions.has("15-freezing"),n=selectedOptions.has("30-freezing");if(t||n){e.style.display="inline";let a=n?"30":"15";e.innerHTML=e.innerHTML.replace(/\d+ дней/,`${a} дней`)}else e.style.display="none"},v=()=>{let e=y(),t=optionsData[e];if(!t)return;let n=t.startPrice||0,a=selectedOptions.has("2-mounth")?12:10,i=selectedOptions.has("nolimit"),r=document.querySelector(".your-card__option[id='20-trainings']");r&&(r.style.display=i?"none":"inline"),selectedOptions.forEach(e=>{"nolimit"===e?n+=1e3*a:n+=t[e]||0});let o=document.querySelector(".your-card__option[id='validPeriod']");o.innerHTML=o.innerHTML.replace(/\d+ месяцев/,`${a} месяцев`),h();let s=document.querySelector('.your-card__option[id="20-trainings"]');s&&(s.innerHTML=s.innerHTML.replace(/(60|80) тренировок/,selectedOptions.has("20-trainings")?"80 тренировок":"60 тренировок"));let l=document.querySelector('.your-card__option[id="fullday"]');l&&(l.innerHTML=l.innerHTML.replace(/до\s(16:00|22:00)/,selectedOptions.has("fullday")?"до 22:00":"до 16:00"));let $=Math.round(n/a);p.textContent=`${$.toLocaleString()}₽`;let c=Math.round(.25*n);formData.totalPrice=n,formData.monthlyPrice=$,formData.plaitePrice=c,updateFormData();let d=Array.from(document.querySelectorAll(".your-card__option")).filter(e=>"inline"===getComputedStyle(e).display);d.forEach((e,t)=>{let n=e.querySelector(".gray-text");n?(n.textContent=n.textContent.replace(/[.,]\s*$/,""),n.textContent+=t===d.length-1?".":","):(e.innerHTML=e.innerHTML.replace(/[.,]\s*$/,""),e.innerHTML+=t===d.length-1?".":",")}),saveSessionState()},L=(e,t)=>{let n=document.querySelector(`.options__item[data-opt-id="${e}"] .my-switch-main`);if(n){if(n.checked=t,"15-freezing"===e&&t){selectedOptions.delete("30-freezing");let a=document.querySelector('.options__item[data-opt-id="30-freezing"] .my-switch-main');a&&(a.checked=!1)}if("30-freezing"===e&&t){selectedOptions.delete("15-freezing");let i=document.querySelector('.options__item[data-opt-id="15-freezing"] .my-switch-main');i&&(i.checked=!1)}t?(selectedOptions.add(e),S(e,!0)):(selectedOptions.delete(e),S(e,!1)),v(),f()}};function _(e){return/^[A-Za-zА-Яа-яЁё\s\-]{2,}$/.test(e.trim())}function b(e){let t=e.replace(/\D/g,"");return 11===t.length}function D(){let e=!0;return _(l.value)?l.classList.remove("invalid"):(l.classList.add("invalid"),e=!1),b($.value)?$.classList.remove("invalid"):($.classList.add("invalid"),e=!1),d.checked?d.closest(".my-checkbox-btn").classList.remove("invalid"):(d.closest(".my-checkbox-btn").classList.add("invalid"),e=!1),e}function k(){return a.classList.contains("--display-none")?(e.classList.add("--white-bg"),t.classList.add("--form-page"),!1):(e.classList.remove("--white-bg"),t.classList.remove("--form-page"),!0)}l.addEventListener("input",updateFormData),$.addEventListener("input",updateFormData),c.addEventListener("change",updateFormData),d.addEventListener("change",()=>{d.closest(".my-checkbox-btn").classList.remove("invalid")}),m.addEventListener("change",()=>{g(y()),updateFormData()}),u.forEach(e=>{let t=e.querySelector(".my-switch-main"),n=e.dataset.optId;t.addEventListener("change",()=>{let e=t.checked;"nolimit"===n&&e&&L("20-trainings",!1),"20-trainings"===n&&e&&L("nolimit",!1),L(n,e)})}),[l,$].forEach(e=>{e.addEventListener("focus",()=>{e.classList.remove("invalid")})}),r.addEventListener("click",async e=>{if(e.preventDefault(),!D())return;let{name:t,phone:i,city:r}=formData,o=t!==lastSentFormData.name||i!==lastSentFormData.phone||r!==lastSentFormData.city;o&&(await sendInitialFormToTelegram(t,i,r),lastSentFormData={...formData}),n.classList.add("--display-none"),a.classList.remove("--display-none"),k(),localStorage.getItem("tickStarted")||localStorage.setItem("tickStarted","true"),handleTickInit(localTick),saveSessionState()}),o.addEventListener("click",()=>{i.classList.contains("--final-page")?(i.classList.remove("--final-page"),k(),saveSessionState()):(n.classList.remove("--display-none"),a.classList.add("--display-none"),k(),l.value=formData.name,$.value=formData.phone,c.checked=formData.sendingAgree,m.value=formData.city,g(y()),updateFormData())}),s&&s.addEventListener("click",()=>{i.classList.add("--final-page"),f(),saveSessionState()}),document.querySelectorAll(".your-card__option").forEach(e=>e.style.display="none"),document.querySelector(".your-card__option[id='validPeriod']").style.display="inline",document.querySelector(".your-card__option[id='20-trainings']").style.display="inline",document.querySelector(".your-card__option[id='fullday']").style.display="inline";let q=loadSessionState();if(q){let{formData:T,selectedOptions:z,currentPage:E}=q;l.value=T.name,$.value=T.phone,m.value=T.city,c.checked=T.sendingAgree,selectedOptions=new Set(z||[]),z.forEach(e=>{L(e,!0)}),"bonuses"===E&&(n.classList.add("--display-none"),a.classList.remove("--display-none"),e.classList.add("--white-bg"),t.classList.add("--form-page")),"final"===E&&(n.classList.add("--display-none"),a.classList.remove("--display-none"),i.classList.add("--final-page"),f(),e.classList.add("--white-bg"),t.classList.add("--form-page")),g(y()),v(),updateFormData(),f()}else g(y()),v(),updateFormData(),f();k(),new SimpleBar(document.querySelector(".options__inner"),{autoHide:!1,forceVisible:!0});let O={angarsk:"Ангарск",krasnoyarsk:"Красноярск",novosibirsk:"Новосибирск",tyumen:"Тюмень",saratov:"Саратов",ekaterinburg:"Екатеринбург",ufa:"Уфа",chelyabinsk:"Челябинск",kazan:"Казань"},P={motivator:"+Мотиватор",nolimit:"+Безлимит",massage:"+Массаж","20-trainings":"+20 тренировок",fullday:"+Полный день","15-freezing":"+15 дней заморозки","30-freezing":"+30 дней заморозки","2-mounth":"+2 месяца","summer-events":"+Летние мероприятия"};function A(){let e=formData.name.trim(),t=formData.phone.trim(),n=formData.totalPrice.toLocaleString(),a=formData.city,i=O[a],r=formData.selectedOptions.map(e=>P[e]).filter(Boolean),o="60 тренировок",s="дневная&nbsp;карта&nbsp;(до&nbsp;16:00)";r.includes("+Безлимит")&&(o="безлимит"),r.includes("+Полный день")&&(s="дневная&nbsp;карта&nbsp;(до&nbsp;18:00)");let l=r.length>0?`опции ${r.join(", ")}`:null,$=`Здравствуйте! Это ${e}, телефон ${t}, г. ${i}, я выбрала 10 месяцев, ${o}, ${s}${l?`, ${l}`:""}, сумма получилась ${n}₽`,c=encodeURIComponent($);return`https://wa.me/79245372601?text=${c}&type=phone_number`}let w=document.querySelector(".final-page__button");w&&w.addEventListener("click",function(e){let t=A();w.setAttribute("href",t)})});const BOT_TOKEN="7697468478:AAGm0FLdOYb3q2eh_7PZsdE4XKU3TiVo0bA",CHAT_ID="-4863296373";let lastSentFormData={name:"",phone:"",city:""};async function sendInitialFormToTelegram(e,t,n){let a=`Новая заявка!

Имя: ${e}
Телефон: ${t}
Город: ${{angarsk:"Ангарск",krasnoyarsk:"Красноярск",novosibirsk:"Новосибирск",tyumen:"Тюмень",saratov:"Саратов",ekaterinburg:"Екатеринбург",ufa:"Уфа",chelyabinsk:"Челябинск",kazan:"Казань"}[n]}`;try{let i=await fetch("https://api.telegram.org/bot7697468478:AAGm0FLdOYb3q2eh_7PZsdE4XKU3TiVo0bA/sendMessage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:"-4863296373",text:a,parse_mode:"HTML"})}),r=await i.json();r.ok?console.log("Первичное сообщение отправлено!"):console.error("Ошибка при отправке:",r.description)}catch(o){console.error("Сетевая ошибка:",o)}}